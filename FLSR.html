<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<title>FLSR. FLCore 2.5.20140814</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="author" content="
The FLR Team
">

<link href="css/bootstrap.css" rel="stylesheet">
<link href="css/bootstrap-responsive.css" rel="stylesheet">
<link href="css/highlight.css" rel="stylesheet">
<link href="css/staticdocs.css" rel="stylesheet">

<!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
<![endif]-->
  </head>

  <body>
    <div class="navbar">
  <div class="navbar-inner">
    <div class="container">
      <a class="brand" href="#">FLCore 2.5.20140814</a>
      <div class="nav">
        <ul class="nav">
          <li><a href="index.html"><i class="icon-home icon-white"></i> Index</a></li>
        </ul>
      </div>
    </div>
  </div>
</div>

    <div class="container">
      <header>
        
      </header>
      
      <h1>Class FLSR</h1>

<div class="row">
  <div class="span8">
        
    <div class="Class FLSR">
      <h2>Class FLSR</h2>
      
    </div>

    <div class="Description">
      <h2>Description</h2>
      
      <p>Class for stock-recruitment models.</p>
  
    </div>

    <div class="Details">
      <h2>Details</h2>
      
      <p>A series of commonly-used stock-recruitment models are already available,
including the corresponding likelihood functions and calculation of initial
values. See <code><a href='SRModels.html'>SRModels</a></code> for more details and the exact
formulation implemented for each of them.</p>
  
    </div>

    <div class="Slots">
      <h2>Slots</h2>
      
      <p><dl>
<dt>name</dt><dd>Name of the object (<code>character</code>).</dd>
<dt>desc</dt><dd>Description of the object (<code>character</code>).</dd>
<dt>range</dt><dd>Range (<code>numeric</code>).</dd>
<dt>rec</dt><dd>Recruitment series (<code>FLQuant</code>).</dd>
<dt>ssb</dt><dd>Index of reproductive potential, e.g. SSB or egg oor egg production (<code>FLQuant</code>).</dd>
<dt>fitted</dt><dd>Estimated values for rec (<code>FLQuant</code>).</dd>
<dt>residuals</dt><dd>Residuals obtained from the model fit (<code>FLArray</code>).</dd>
<dt>covar</dt><dd>Covariates for SR model (<code>FLQuants</code>).</dd>
<dt>model</dt><dd>Model formula (<code>formula</code>).</dd>
<dt>gr</dt><dd>Function returning the gradient of the likelihood (<code>function</code>).</dd>
<dt>logl</dt><dd>Log-likelihood function (<code>function</code>).</dd>
<dt>initial</dt><dd>Function returning initial parameter values for the optimizer (<code>function</code>).</dd>
<dt>params</dt><dd>Estimated parameter values (<code>FLPar</code>).</dd>
<dt>logLik</dt><dd>Value of the log-likelihood (<code>logLik</code>).</dd>
<dt>vcov</dt><dd>Variance-covariance matrix (<code>array</code>).</dd>
<dt>details</dt><dd>Extra information on the model fit procedure (<code>list</code>).</dd>
<dt>logerror</dt><dd>Is the error on a log scale (<code>logical</code>).</dd>
<dt>distribution</dt><dd>(<code>factor</code>).</dd>
<dt>hessian</dt><dd>Resulting Hessian matrix from the fit (<code>array</code>).</dd>
</dl></p>
  
      <p></p>
  
    </div>
    
    <h2 id="examples">Examples</h2>
    <pre class="examples"><div class='input'># Create an empty FLSR object.
    sr1 &lt;- FLSR()

    # Create an  FLSR object using the existing SR models.
    sr2 &lt;- FLSR(model = &#39;ricker&#39;)
    sr2@model
</div>
<div class='output'>rec ~ a * ssb * exp(-b * ssb)
&lt;environment: 0x4edec48&gt;
</div>
<div class='input'>    sr2@initial
</div>
<div class='output'>function(rec, ssb) {
		# The function to provide initial values
    res  &lt;-coefficients(lm(log(c(rec)/c(ssb))~c(ssb)))
    return(FLPar(a=max(exp(res[1])), b=-max(res[2])))}
&lt;environment: 0x4edec48&gt;
attr(,&quot;lower&quot;)
[1] -Inf -Inf
attr(,&quot;upper&quot;)
[1] Inf Inf
</div>
<div class='input'>    sr2@logl
</div>
<div class='output'>function(a, b, rec, ssb)
      loglAR1(log(rec), log(a*ssb*exp(-b*ssb)))
&lt;environment: 0x4edec48&gt;
</div>
<div class='input'>
    sr3 &lt;- FLSR(model = &#39;bevholt&#39;)
    sr3@model
</div>
<div class='output'>rec ~ a * ssb/(b + ssb)
&lt;environment: 0x4087d10&gt;
</div>
<div class='input'>    sr3@initial
</div>
<div class='output'>function(rec, ssb) {
    a &lt;- max(quantile(c(rec), 0.75, na.rm = TRUE))
    b &lt;- max(quantile(c(rec)/c(ssb), 0.9, na.rm = TRUE))
    return(FLPar(a = a, b = a/b))}
&lt;environment: 0x4087d10&gt;
attr(,&quot;lower&quot;)
[1] -Inf -Inf
attr(,&quot;upper&quot;)
[1] Inf Inf
</div>
<div class='input'>    sr3@logl
</div>
<div class='output'>function(a, b, rec, ssb)
      loglAR1(log(rec), log(a*ssb/(b+ssb)))
&lt;environment: 0x4087d10&gt;
</div>
<div class='input'>
    # Create an FLSR using a function.
    mysr1 &lt;- function(){
        model &lt;- rec ~ a*ssb^b
        return(list(model = model))}

    sr4 &lt;- FLSR(model = mysr1)

    # Create an FLSR using a function and check that it works.
    mysr2 &lt;- function(){
        formula &lt;- rec ~ a+ssb*b

        logl &lt;- function(a, b, sigma, rec, ssb) sum(dnorm(rec,
            a + ssb*b, sqrt(sigma), TRUE))

       initial &lt;- structure(function(rec, ssb) {
            a     &lt;- mean(rec)
            b     &lt;- 1
            sigma &lt;- sqrt(var(rec))

            return(list(a= a, b = b, sigma = sigma))}, lower = c(0, 1e-04, 1e-04), upper = rep(Inf, 3))

       return(list(model = formula, initial = initial, logl = logl))
    }

    ssb &lt;- FLQuant(runif(10, 10000, 100000))
    rec &lt;- 10000 + 2*ssb + rnorm(10,0,1)
    sr5 &lt;- FLSR(model = mysr2, ssb = ssb, rec = rec)

    sr5.mle &lt;- fmle(sr5)
</div>
<div class='output'>  Nelder-Mead direct search function minimizer
function value for initial parameters = 435613.767398
  Scaled convergence tolerance is 0.00649115
Stepsize computed as 12705.455353
BUILD              4 70319212732858.546875 338741.295265
LO-REDUCTION       6 15374105991756.820312 338741.295265
HI-REDUCTION       8 3924354449480.104492 338741.295265
HI-REDUCTION      10 991127605846.846191 338741.295265
HI-REDUCTION      12 248860860332.084778 338741.295265
HI-REDUCTION      14 62252921043.342003 338741.295265
HI-REDUCTION      16 15518912834.018864 338741.295265
HI-REDUCTION      18 3849783347.480143 338741.295265
HI-REDUCTION      20 946645588.962461 338741.295265
HI-REDUCTION      22 228805464.906723 338741.295265
HI-REDUCTION      24 53426731.780353 338741.295265
HI-REDUCTION      26 11636348.652440 338741.295265
HI-REDUCTION      28 2217609.892479 338741.295265
HI-REDUCTION      30 621193.331380 338741.295265
REFLECTION        32 435613.767398 177534.421821
LO-REDUCTION      34 377567.115652 177534.421821
LO-REDUCTION      36 338741.295265 130745.133972
HI-REDUCTION      38 233310.073485 130745.133972
HI-REDUCTION      40 177534.421821 130745.133972
HI-REDUCTION      42 151363.914031 128324.674566
HI-REDUCTION      44 146412.064980 126130.975799
HI-REDUCTION      46 130745.133972 123496.748292
HI-REDUCTION      48 128324.674566 118618.776495
HI-REDUCTION      50 126130.975799 118618.776495
LO-REDUCTION      52 123496.748292 118432.156092
REFLECTION        54 120691.574731 115188.661619
LO-REDUCTION      56 118618.776495 114798.460729
REFLECTION        58 118432.156092 114401.353273
LO-REDUCTION      60 115188.661619 114092.261399
EXTENSION         62 114798.460729 111231.394896
LO-REDUCTION      64 114401.353273 111231.394896
REFLECTION        66 114092.261399 110615.565150
LO-REDUCTION      68 112083.264724 110615.565150
EXTENSION         70 111231.394896 108451.041447
LO-REDUCTION      72 110843.803011 108451.041447
HI-REDUCTION      74 110615.565150 108451.041447
EXTENSION         76 109092.123884 105675.522560
LO-REDUCTION      78 108840.153905 105675.522560
EXTENSION         80 108451.041447 102322.317115
EXTENSION         82 106316.996771 99277.417546
LO-REDUCTION      84 105675.522560 99277.417546
EXTENSION         86 102322.317115 93260.568966
LO-REDUCTION      88 101606.651865 93260.568966
EXTENSION         90 99277.417546 87970.021986
LO-REDUCTION      92 96489.344378 87970.021986
EXTENSION         94 93260.568966 78366.989737
LO-REDUCTION      96 88574.347182 78366.989737
EXTENSION         98 87970.021986 70822.981348
EXTENSION        100 80656.160100 63056.172204
EXTENSION        102 78366.989737 56301.167545
EXTENSION        104 70822.981348 46474.503431
EXTENSION        106 63056.172204 39860.581742
EXTENSION        108 56301.167545 35756.034822
EXTENSION        110 46474.503431 30243.708685
LO-REDUCTION     112 39860.581742 30243.708685
LO-REDUCTION     114 35756.034822 30243.708685
REFLECTION       116 30325.704272 28713.581322
LO-REDUCTION     118 30292.392088 28713.581322
LO-REDUCTION     120 30243.708685 28713.581322
REFLECTION       122 29312.379310 28694.341465
REFLECTION       124 28761.280268 28586.731257
HI-REDUCTION     126 28713.581322 28571.175579
REFLECTION       128 28694.341465 28497.538705
LO-REDUCTION     130 28586.731257 28458.393468
LO-REDUCTION     132 28571.175579 28429.915356
LO-REDUCTION     134 28497.538705 28429.915356
LO-REDUCTION     136 28458.393468 28407.320751
LO-REDUCTION     138 28430.481752 28397.506197
HI-REDUCTION     140 28429.915356 28397.506197
LO-REDUCTION     142 28407.320751 28388.433989
HI-REDUCTION     144 28399.401317 28388.433989
EXTENSION        146 28397.506197 28375.348752
HI-REDUCTION     148 28390.325187 28375.348752
EXTENSION        150 28388.433989 28359.315553
LO-REDUCTION     152 28384.160341 28359.315553
EXTENSION        154 28375.348752 28341.018431
EXTENSION        156 28369.276222 28326.550908
EXTENSION        158 28359.315553 28267.762597
EXTENSION        160 28341.018431 28238.060061
EXTENSION        162 28326.550908 28220.994163
EXTENSION        164 28267.762597 28036.531905
LO-REDUCTION     166 28238.060061 28036.531905
LO-REDUCTION     168 28220.994163 28036.531905
REFLECTION       170 28119.791383 27997.472948
EXTENSION        172 28089.578049 27840.658017
LO-REDUCTION     174 28036.531905 27840.658017
EXTENSION        176 27997.472948 27678.416930
EXTENSION        178 27858.841104 27356.225489
EXTENSION        180 27840.658017 27053.599143
EXTENSION        182 27678.416930 26657.289327
EXTENSION        184 27356.225489 25599.402105
EXTENSION        186 27053.599143 24535.974300
REFLECTION       188 26657.289327 24518.729256
EXTENSION        190 25599.402105 20902.331446
LO-REDUCTION     192 24535.974300 20902.331446
REFLECTION       194 24518.729256 20666.201943
EXTENSION        196 21888.640204 13205.491734
LO-REDUCTION     198 20902.331446 13205.491734
LO-REDUCTION     200 20666.201943 13205.491734
EXTENSION        202 16369.407631 9546.635111
</div>
<strong class='warning'>Warning message:
NaNs produced</strong>
<div class='output'>REFLECTION       204 15277.352620 8256.990131
REFLECTION       206 13205.491734 4846.137670
HI-REDUCTION     208 9546.635111 4846.137670
LO-REDUCTION     210 8428.283094 4846.137670
</div>
<strong class='warning'>Warning message:
NaNs produced</strong>
<div class='output'>HI-REDUCTION     212 8256.990131 4846.137670
EXTENSION        214 6436.490144 3889.636196
EXTENSION        216 4855.277386 1763.017029
LO-REDUCTION     218 4846.137670 1763.017029
LO-REDUCTION     220 3889.636196 1763.017029
LO-REDUCTION     222 3002.678038 1763.017029
EXTENSION        224 1795.383375 225.184884
LO-REDUCTION     226 1787.367641 225.184884
REFLECTION       228 1763.017029 176.506759
LO-REDUCTION     230 1082.077388 167.108223
REFLECTION       232 225.184884 154.774718
HI-REDUCTION     234 176.506759 124.545502
REFLECTION       236 167.108223 94.253897
HI-REDUCTION     238 154.774718 81.301759
HI-REDUCTION     240 124.545502 81.301759
HI-REDUCTION     242 94.253897 78.571175
HI-REDUCTION     244 87.340992 77.251759
HI-REDUCTION     246 81.301759 74.266813
HI-REDUCTION     248 78.571175 72.868946
HI-REDUCTION     250 77.251759 72.796792
HI-REDUCTION     252 74.266813 72.796792
HI-REDUCTION     254 73.224616 72.331398
HI-REDUCTION     256 72.868946 72.029670
HI-REDUCTION     258 72.796792 71.891190
LO-REDUCTION     260 72.331398 71.891190
REFLECTION       262 72.068736 71.816334
HI-REDUCTION     264 72.029670 71.772636
HI-REDUCTION     266 71.891190 71.772291
HI-REDUCTION     268 71.816334 71.745411
HI-REDUCTION     270 71.772636 71.727504
HI-REDUCTION     272 71.772291 71.722394
LO-REDUCTION     274 71.745411 71.722394
LO-REDUCTION     276 71.728390 71.711975
HI-REDUCTION     278 71.727504 71.711975
LO-REDUCTION     280 71.722394 71.709580
Exiting from Nelder Mead minimizer
    282 function evaluations used
</div>
<div class='input'>    sr5.nls &lt;- nls(sr5)

# NS Herring stock-recruitment dataset
data(nsher)

# already fitted with a Ricker SR model
summary(nsher)
</div>
<div class='output'>An object of class &quot;FLSR&quot;

Name: Autumn spawning herring in IV, V  3/4/2005 14:46 
Description: &#39;rec&#39; and &#39;ssb&#39; slots obtained from a &#39;FLStock&#39; object 
Range:	  
		
Quant: age 

rec           : [ 1 45 1 1 1 1 ], units =  10^3 
ssb           : [ 1 45 1 1 1 1 ], units =  t*10^3 
residuals     : [ 1 45 1 1 1 1 ], units =  NA 
fitted        : [ 1 45 1 1 1 1 ], units =  10^3 

Model: 	rec ~ a * ssb * exp(-b * ssb)
&lt;environment: 0x31e1ff8&gt;
Parameters: 
    params
iter     a        b
   1 119.4 0.009027

Log-likelihood:  16.352(0) 
Variance-covariance:    
               a            b
  a 258.66388793 1.838394e-02
  b   0.01838394 2.002586e-06
</div>
<div class='input'>
plot(nsher)
</div>
<strong class='warning'>Warning message:
Selected elements do not form a coherent 6D array</strong>
<strong class='warning'>Warning message:
Selected elements do not form a coherent 6D array</strong>
<strong class='warning'>Warning message:
Selected elements do not form a coherent 6D array</strong>
<strong class='warning'>Warning message:
Selected elements do not form a coherent 6D array</strong>
<strong class='warning'>Warning message:
Selected elements do not form a coherent 6D array</strong>
<strong class='warning'>Warning message:
Selected elements do not form a coherent 6D array</strong>
<strong class='warning'>Warning message:
Selected elements do not form a coherent 6D array</strong>
<strong class='warning'>Warning message:
Selected elements do not form a coherent 6D array</strong>
<div class='input'>
# change model
model(nsher) &lt;- bevholt()

# fit through MLE
nsher &lt;- fmle(nsher)
</div>
<div class='output'>  Nelder-Mead direct search function minimizer
function value for initial parameters = -10.336211
  Scaled convergence tolerance is 1.54022e-07
Stepsize computed as 501.110000
BUILD              3 44.842344 -11.603908
HI-REDUCTION       5 31.685209 -11.603908
HI-REDUCTION       7 17.913114 -11.603908
HI-REDUCTION       9 5.415279 -11.603908
HI-REDUCTION      11 -3.412974 -11.603908
HI-REDUCTION      13 -8.018030 -11.603908
LO-REDUCTION      15 -10.336211 -11.603908
LO-REDUCTION      17 -11.081040 -11.603908
EXTENSION         19 -11.295930 -12.061705
LO-REDUCTION      21 -11.603908 -12.061705
REFLECTION        23 -11.813826 -12.087620
REFLECTION        25 -12.061705 -12.199591
LO-REDUCTION      27 -12.087620 -12.199591
LO-REDUCTION      29 -12.158184 -12.199591
LO-REDUCTION      31 -12.191726 -12.199591
HI-REDUCTION      33 -12.192269 -12.199591
HI-REDUCTION      35 -12.197784 -12.199591
LO-REDUCTION      37 -12.198015 -12.199591
HI-REDUCTION      39 -12.199555 -12.199776
REFLECTION        41 -12.199591 -12.200058
HI-REDUCTION      43 -12.199776 -12.200092
HI-REDUCTION      45 -12.200058 -12.200142
HI-REDUCTION      47 -12.200092 -12.200155
HI-REDUCTION      49 -12.200142 -12.200160
HI-REDUCTION      51 -12.200155 -12.200177
HI-REDUCTION      53 -12.200160 -12.200177
LO-REDUCTION      55 -12.200171 -12.200179
HI-REDUCTION      57 -12.200177 -12.200179
HI-REDUCTION      59 -12.200178 -12.200179
HI-REDUCTION      61 -12.200179 -12.200179
HI-REDUCTION      63 -12.200179 -12.200179
HI-REDUCTION      65 -12.200179 -12.200179
Exiting from Nelder Mead minimizer
    67 function evaluations used
</div>
<div class='input'>
plot(nsher)
</div>
<strong class='warning'>Warning message:
Selected elements do not form a coherent 6D array</strong>
<strong class='warning'>Warning message:
Selected elements do not form a coherent 6D array</strong>
<strong class='warning'>Warning message:
Selected elements do not form a coherent 6D array</strong>
<strong class='warning'>Warning message:
Selected elements do not form a coherent 6D array</strong>
<strong class='warning'>Warning message:
Selected elements do not form a coherent 6D array</strong>
<strong class='warning'>Warning message:
Selected elements do not form a coherent 6D array</strong>
<strong class='warning'>Warning message:
Selected elements do not form a coherent 6D array</strong>
<strong class='warning'>Warning message:
Selected elements do not form a coherent 6D array</strong></pre>
  </div>
  <div class="span4">
    <!-- <ul>
      <li>FLSR</li><li>FLSR,ANY-method</li><li>FLSR,missing-method</li><li>FLSR-class</li><li>FLSR-methods</li>
    </ul>
    <ul>
      <li>classes</li>
    </ul> -->
      
    <h2>See also</h2>
    
<a href='FLModel-class.html'>FLModel</a>, <a href='FLComp.html'>FLComp</a>

    
    <h2>Author</h2>
    
The FLR Team

    
  </div>
</div>
      
      <footer>
      <p class="pull-right"><a href="#">Back to top</a></p>
<p>Built by <a href="https://github.com/hadley/staticdocs">staticdocs</a>. Styled with <a href="http://twitter.github.com/bootstrap">bootstrap</a>.</p>
      </footer>
    </div>
  </body>
</html>